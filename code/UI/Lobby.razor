@using Sandbox;
@using Sandbox.UI;
@using System;
@inherits PanelComponent;

<root>
    <logo class="logo">UNDERWATER</logo>

    <div class="horizontal-menu">
        <div class="team">
            <div class="team-name">Red Team</div>

            <div class="players">
                @foreach (Guid playerId in redPlayers)
                {
                    GameObject player = Scene.Directory.FindByGuid(playerId);
                    
                    if (player is not null)
                    {
                        Connection client = player.Network.OwnerConnection;
                        <div class="player">@client.DisplayName</div>
                    }
                }
            </div>
 
            @if (lobbyManager.CanJoinTeam(Team.Red))
            {
                <div class="center-panel">
                    <button onclick=@(() => lobbyManager.ChangeTeam(Team.Red))>Join</button>
                </div>
            }
        </div>

        <div class="vs">
            <label>VS.</label>
        </div>

        <div class="team">
            <div class="team-name">Blue Team</div>

            <div class="players">
                @foreach (Guid playerId in bluePlayers )
                {
                    GameObject player = Scene.Directory.FindByGuid(playerId);
                    
                    if (player is not null)
                    {
                        Connection client = player.Network.OwnerConnection;
                        <div class="player">@client.DisplayName</div>
                    }
                }
            </div>
            
            @if (lobbyManager.CanJoinTeam(Team.Blue))
            {
                <div class="center-panel">
                    <button onclick=@(() => lobbyManager.ChangeTeam(Team.Blue))>Join</button>
                </div>
            }
            
        </div>
    </div>
</root>

@code 
{
    [Property] public GameObject lobbyObject;

    private LobbyManager lobbyManager;

    private NetList<Guid> redPlayers = new();
    private NetList<Guid> bluePlayers = new();

    protected override void OnStart()
    {
        lobbyManager = lobbyObject.Components.Get<LobbyManager>();
    }

    public void UpdatePlayerList(NetList<Guid> redPlayers, NetList<Guid> bluePlayers)
    {
        this.redPlayers = redPlayers;
        this.bluePlayers = bluePlayers;

        StateHasChanged();
    }

    protected override int BuildHash() => System.HashCode.Combine(RealTime.Now.CeilToInt());
}
