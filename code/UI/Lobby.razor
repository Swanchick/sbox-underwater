@using Sandbox;
@using Sandbox.UI;
@using Sandbox.Network;
@using System.Threading.Tasks;
@using System;
@inherits PanelComponent;

<root>
    <div class="menu">
        <div class="header">Lobby Menu</div>
        
        @if (players.Count != 0)
        {
            foreach (PlayerTeam team in players)
            {
                <div>@team.DisplayName</div>
            }
        }

        <button onclick=@(() => StartGame())>Start Game</button>
    </div>
</root>

@code
{
    [Property] public GameNetworkManager gameNetworkManager;

    private NetList<PlayerTeam> players = new();

    protected override void OnStart()
    {
        _ = UpdatePlayerList();
    }

    private async Task UpdatePlayerList()
    {
        while (true)
        {
            players = gameNetworkManager.PlayersTeam;

            await Task.DelayRealtimeSeconds(5f);
        }
    }

    private void StartGame()
    {
        gameNetworkManager.StartRound();
    }

    protected override int BuildHash() => System.HashCode.Combine(RealTime.Now.CeilToInt());
}
